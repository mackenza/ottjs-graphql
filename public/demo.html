<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Ottawa JS GraphQL Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/skeleton/2.0.4/css/skeleton.css">  
</head>

<body>
    <div class="container">
    <h3>GraphQL Demo - List Commit History for GitHub Repo</h3>
        <form>
        <div class="row">
            <div class="three columns">
                <input type="text" placeholder="GitHub User/Org" class="u-full-width" id="txtuser" />
            </div>
            <div class="three columns">
                <input type="text" placeholder="Repo Name" class="u-full-width" id="txtrepo" />
            </div>
            <div class="one column">
                <input value="Get Commits" type="button" class="button-primary" id="getBtn" />
            </div>    
        </div>
        
        </form>
        <div id="output"></div>
    </div>
  <script>      
    var getBtn = document.getElementById("getBtn");
    var output = document.getElementById("output");
		var username = document.getElementById("txtuser");
		var reponame = document.getElementById("txtrepo");

    function doRequest() {

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
        
        if(xhr.readyState == XMLHttpRequest.DONE) {
               
        if(xhr.status == 200) {
            output.innerText = xhr.responseText;
						console.log(JSON.parse(xhr.responseText));
            
        } else {
            alert('Oops! ' + xhr.status);
        }
        }
    };
		
		const authorFrag = 'author { ... on GithubUser { login avatar_url }} ';
		const sha = 'sha ';
		
    var query = 'query repo ($username: String!, $reponame: String!)' +
						'{repo(ownerUsername: $username, name: $reponame)' +
						'{name, commits { message ' +
						authorFrag +
						sha +
						'}}}&variables={"username": "' + username.value + '", ' +
  					'"reponame": "' + reponame.value + '"}' +
						'&raw';
		console.log(typeof(query));
    xhr.open('GET', 'http://localhost:3000/gh?query=' + query, true);
    xhr.send();
}

    getBtn.addEventListener('click', doRequest, true);
  </script>
</body>
</html>
