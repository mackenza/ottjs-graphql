<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Ottawa JS GraphQL Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/skeleton/2.0.4/css/skeleton.css">  
</head>

<body>
    <div class="container">
    <h3>GraphQL Demo - List Commit History for GitHub Repo</h3>
        <form>
        <div class="row">
            <div class="three columns">
                <input type="text" placeholder="GitHub User/Org" class="u-full-width" id="txtuser" />
            </div>
            <div class="three columns">
                <input type="text" placeholder="Repo Name" class="u-full-width" id="txtrepo" />
            </div>
            <div class="one column">
                <input value="Get Commits" type="button" class="button-primary" id="getBtn" />
            </div>    
        </div>
        
        </form>
        <div id="output"></div>
    </div>
  <script>      
    var getBtn = document.getElementById("getBtn");
    var output = document.getElementById("output");

    function doRequest() {

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
        console.log('Request readyState is', xhr.readyState);
        if(xhr.readyState == XMLHttpRequest.DONE) {
        console.log('Request completed');
        console.log('Response status code is', xhr.status);
        
        if(xhr.status == 200) {
            console.log('Response body is', xhr.responseText);
            output.innerText = xhr.responseText;
            
        } else {
            alert('Oops! ' + xhr.status);
        }
        console.log('Done!');
        }
    };

    console.log('Opening the request...')
    var query = 'query repo {repo(ownerUsername: "mackenza", name: "vimfiles") {name' +
            ', commits {message}' +
            '}}&raw';
    xhr.open('GET', 'http://localhost:3000/gh?query=' + query, true);

    console.log('Sending the request...')
    xhr.send();
    console.log('Waiting for the request to complete...');
}

    getBtn.addEventListener('click', doRequest, true);
  </script>
</body>
</html>
